# Samsung Qmage MMS Exploit (CVE-2020-8899)

This is the source code of a Samsung Qmage MMS proof-of-concept exploit, targeting one of the memory corruption vulnerabilities collectively labeled as CVE-2020-8899. The bugs were reported in the Project Zero bug tracker as [issue #2002](https://bugs.chromium.org/p/project-zero/issues/detail?id=2002), and disclosed in May 2020 when Samsung released a fix. The story of the codec discovery, fuzzing and exploit development is documented in a blog post series:

* [Part 1: Introduction to the Samsung Qmage Codec and Remote Attack Surface](https://googleprojectzero.blogspot.com/2020/07/mms-exploit-part-1-introduction-to-qmage.html)
* [Part 2: Effective Fuzzing of the Qmage Codec](https://googleprojectzero.blogspot.com/2020/07/mms-exploit-part-2-effective-fuzzing-qmage.html)
* [Part 3: Constructing the Memory Corruption Primitives](https://googleprojectzero.blogspot.com/2020/07/mms-exploit-part-3-constructing-primitives.html)
* [Part 4: MMS Primer, Completing the ASLR Oracle](https://googleprojectzero.blogspot.com/2020/08/mms-exploit-part-4-completing-aslr-oracle.html)
* [Part 5: Defeating Android ASLR, Getting RCE](https://googleprojectzero.blogspot.com/2020/08/mms-exploit-part-5-defeating-aslr-getting-rce.html)

The exploit code is provided for reference and is especially relevant to Parts 3-5. It is written to run on Windows 10, and requires the following software to be locally installed:

* Python 3 and the [intervaltree](https://pypi.org/project/intervaltree/) package,
* Netwide Assembler (nasm),
* [NowSMS](https://www.nowsms.com/) MMS Gateway with a correctly set up modem.

The script is mostly configured through the config.json file, but there are also some hardcoded values related to the libhwui.so and linker64 modules in exploit.py (see e.g. `LIBHWUI_STEP_SIZE`, `LINKER64_SIZE` and nearby constants).